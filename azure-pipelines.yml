# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

variables:
    name: $(date:yyyyMMdd)$(rev:.r)

trigger:
- master

pool:
  name: Hosted Windows 2019 with VS2019
  demands:
  - msbuild
  - visualstudio

steps:
# ...
# Use NuGet 5
- task: NuGetToolInstaller@0
  displayName: 'Use NuGet 5'
  inputs:
    versionSpec: 5.x
# ...
# Restore NuGet packages.
- task: NuGetCommand@2
  displayName: 'NuGet restore'
  inputs:
    feedsToUse: config
# ...
# Build Solution
- task: VSBuild@1
  displayName: 'Build solution **\*.sln'
  inputs:
    platform: 'any cpu'
  condition: succeededOrFailed()
# ...
# Run Tests
- task: DotNetCoreCLI@2
  displayName: 'Run Tests'
  inputs:
    command: test
    projects: 'test/**/*.csproj'
    arguments: '--logger:trx'
# ...
# Publish Test Results
- task: PublishTestResults@2
  displayName: 'Publish Test Results'
  inputs:
    testResultsFormat: VSTest
    testResultsFiles: 'test/**/*.trx'
# ...
# NuGet pack Orleans.Security Solution
- task: DotNetCoreCLI@2
  displayName: 'NuGet pack Orleans.Security Solution'
  inputs:
    command: pack
    packagesToPack: Orleans.Security.Build.sln
# ...
# Push NuGet packs to feed
- task: NuGetCommand@2
  displayName: 'NuGet push'
  inputs:
    command: push
    publishVstsFeed: 'ebb2809e-41ed-479a-9185-3bfe72acbe84'
